<?php
	$title = "Documentation";
	include("../html-inc/header.html");
?>

<p align="center">
<i>This document is licensed under the
<a href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation
License</a>.  It is copyright 2003, jcoverage ltd.</i>
</p>

<h1>Introduction</h1>

<p>
In a recent interview, James Gosling mused: "I don't think
anybody tests enough of anything" (<ulink
url="http://www.artima.com/intv/goslingD4.html"><citetitle>A
Conversation with James Gosling</citetitle></ulink>).
</p>

<p>
The fact is, software today is horrendously under-tested.
Software maintainence costs are spiralling because few pieces of
software can be changed with any degree of confidence that new
bugs aren't being introduced. 
</p>

<p>
Without continual change and improvement, software is unable to
continue meeting its users' needs. But without comprehensive
automated test-suites, such change can also expose users to very
undesirable risks: the risk that critical features no longer
function as before, the risk of data loss and the risk of a
system crash.
</p>

<p>
Agile software development methodologies are helping improve the
quality of software. Test-driven development, where tests are
written to test features <emphasis>before</emphasis> those
features are added, ensures that every piece of software is
coupled with a test-suite.
</p>



<h2>Why use a coverage tool?</h2>

<p>
No matter how good such methodologies are, and how diligently
they're followed in an organisation, it isn't possible to
ensure that software testing is as comprehensive as it could
be. That's where tools can help.
</p>

<p>
Cobertura is a free, simple and
easy-to-use tool that will complement your existing Java
development practices. It helps you discover exactly where
your software is being tested and, more importantly, where it
<emphasis>isn't</emphasis>. Cobertura will help you to view
your software from a number of levels, from the entire system
right down to an individual line of code.
</p>



<h2>Why use Cobertura?</h2>

<p>
Sure, there are other coverage tools around, so what makes
Cobertura different?
</p>

<p>
Coverage analysers work by adding instrumentation. For Java,
coverage analysers fall into three categories: those that
insert instrumentation into the source code, those that add
instrumentation to the Java byte-code, and those that run the
code in a modified JVM. Cobertura adds instrumentation
directly to the bytecode. We feel this is the best approach,
since does not require a modified VM, but still retains a big
speed advantage over having to recompile all your source code
twice.
</p>

<p>
Secondly, Cobertura is easy to integrate with Apache Ant. It
comes with it's own Ant task definitions for you to use. You
can choose to instrument any code you wish, from a single
class to an entire system.
</p>

<p>
Finally, Cobertura is completely free and not time-locked, so
you can begin to use it today, without having to worry about
what to do at the end of an evaluation period. What's more, we
believe Cobertura is so easy to use, you'll be up and running
in no time. So why not spend the next 15 minutes getting up
and running with Cobertura. In that time, you'll certainly
find out which parts of your code are completely tested, and
where your code could do with a bit more testing...
</p>



<h1>Getting started</h1>

<p>
This chapter assumes you are already familiar with the Ant build
tool from Apache.  If you're unfamiliar with Ant, you can find
out about it at <ulink
url="http://ant.apache.org">http://ant.apache.org</ulink>.
</p>



<h2>Adding the Cobertura custom tasks to Ant</h2>

<p>
Cobertura seemlessly integrates with Ant using custom
tasks. But before you can use these new tasks, you have to
declare them in your Ant build file, typically named
<filename>build.xml</filename>. This is done using the
<sgmltag>taskdef</sgmltag> element, as shown below. Place this
element anywhere in your Ant build file.
</p>

      <example id="id-356baf1b-d040-4ed5-b76f-1be1a70c7d32">
        <title>
          Adding the Cobertura custom tasks to Ant.
        </title>
        <programlisting>
  <![CDATA[
  <taskdef classpath="cobertura.jar" resource="tasks.properties"/>
  ]]>
        </programlisting>
      </example>

      <p>
        Now we're ready to start using the Cobertura tasks.
      </p>



<h2>Adding instrumentation to your classes</h2>

<p>
Cobertura works by inserting
instrumentation instructions directly into your compiled Java
classes. When these instructions are encountered by the Java
Virtual Machine, the inserted code increments various counters
so that it is possible to tell which instructions have been
encountered and which have not.
</p>

<p>
You instruct Ant to create instrumented versions of your
classes using the <sgmltag class="starttag">instrument</sgmltag> task. The
example below assumes the classes belong in a directory called
<filename>build/classes</filename>.
</p>

      <example>
        <title>
          Instrumenting classes.
        </title>
        <programlisting>
<![CDATA[
    <instrument todir="build/instrumented-classes">
      <fileset dir="build/classes">
        <include name="**/*.class"/>
      </fileset>
    </instrument>
]]>
        </programlisting>
      </example>



<h2>Running an instrumented application</h2>

<p>
Once your classes have been instrumented by Cobertura, you can
continue testing your application as you would normally via
the <sgmltag class="starttag">junit</sgmltag> task.
</p>

<p>
Simply include a <sgmltag class="starttag">classpath</sgmltag>
entry for the instrumented classes <emphasis>before</emphasis>
any reference to the original classes. This will ensure that
the instrumented classes are loaded in preference to the
original classes.
</p>

      <example>
        <title>
          Testing the instrumented application
        </title>
        <programlisting>
<![CDATA[
<junit fork="yes">
  <classpath location="${build.instrumented.dir}"/>
  <classpath location="${build.classes.dir}"/>
  ...
</junit>
]]>
        </programlisting>
        <p>
          The instrumented classes found in
          <varname>${build.instrumented.dir}</varname> will be loaded
          before those found in
          <varname>${build.classes.dir}</varname> ensuring that the
          instrumented classes are used by <sgmltag
          class="starttag">junit</sgmltag>.
        </p>
      </example>

<p>
An instrumented class serializes information into the file,
<filename>cobertura.ser</filename>. Any existing
information found in this file will be merged with the current
information. In this way the instrumentation for several
sessions of a running program can be merged together,
producing a single coverage report. For example, the
instrumentation from unit and functional tests can be merged
together to produce a single coverage report.
</p>



<h2>Cobertura reporting</h2>

<p>
An instrumented class serializes coverage information to the
file <filename>cobertura.ser</filename>. Using the
<sgmltag class="starttag">report</sgmltag> tag,
Cobertura can generate coverage reports
in either <acronym>HTML</acronym> or <acronym>XML</acronym> format.
</p>

      <example id="id-f27813e1-7f06-4477-a133-4af3c65cac73">
        <title>
          <acronym>HTML</acronym> coverage report
        </title>
        <p>
          The default format for a Cobertura
          report is <acronym>HTML</acronym>.
        </p>
        <programlisting>
<![CDATA[
<target name="coverage">
  <report srcdir="${src.dir}" destdir="${build.coverage.dir}"/>
</target>
]]>
        </programlisting>
      </example>

      <example id="id-988a143c-fbc5-4bd9-8ca0-e8f1145b2e9f">
        <title>
          <acronym>XML</acronym> coverage report
        </title>
        <p>
          The type of report generated is controlled by the <sgmltag
          class="attribute">format</sgmltag> attribute of the <sgmltag
          class="starttag">report</sgmltag> tag, which may be either
          <quote>html</quote> or <quote>xml</quote>. If the <sgmltag
          class="attribute">format</sgmltag> is not supplied then it
          defaults to <quote>html</quote>.
        </p>
        <programlisting>
<![CDATA[
<target name="coverage">
  <report format="xml" srcdir="${src.dir}" destdir="${build.coverage.dir}"/>
</target>
]]>
        </programlisting>
      </example>



<h2>Cobertura session merging</h2>

<p>
Sometimes it is necessary to merge several Cobertura sessions
together, for example, to produce a single consolidated
coverage report from several different test runs of an
application.
</p>

      <example id="id-a7919dac-2e5f-4869-a937-16838da8d481">
        <title>
          Session merging with the <sgmltag class="starttag">merge</sgmltag> tag
        </title>
        <programlisting>
<![CDATA[
<merge>
  <fileset dir="${basedir}">
    <include name="**/cobertura.ser"/>
  </fileset>
</merge>
]]>
        </programlisting>
        <p>
          The above fragment from an ANT build file, will merge
          together any serialised instrumentation that has been
          generated by Cobertura and produce a single consolidated
          instrumentation record.
        </p>
      </example>



<h2>Taking control with Cobertura and check</h2>
<p>
All too often testing is something that is left until the end
of the development cycle. For example, a coverage report is
run on a weekly basis over the codebase, only when the
coverage metrics fall below a certain pain threshold are the
developers directed to increase their test coverage and
quality.
</p>

<p>
With Cobertura development teams can
choose to enforce <emphasis>test driven development</emphasis>
on their codebase, by using the <sgmltag
class="starttag">check</sgmltag> tag in their ANT build
scripts.
</p>

<p>
After each <emphasis>instrumented</emphasis> unit test
sequence, Cobertura can do a <quote>health check</quote> to
ensure that the codebase is being tested to the standard that
has been demanded by the team. If coverage standards fall
below the critea set by the team, <sgmltag
class="starttag">check</sgmltag> will fail the build.
</p>

<p>
Our intention with check
is to ensure that test driven development practices are being
followed by the entire development team. Inadequate testing
will result in an immediate <emphasis>automated</emphasis>
build failure, without having to study the entire coverage
report.
</p>

      <example id="id-2b9cb218-e074-48c9-bade-203f96d0ecaa">
        <title>
          <sgmltag class="starttag">check</sgmltag>
        </title>
        <programlisting>
<![CDATA[
<check branch="80" line="80">
  <regex pattern="com.cobertura.util.*" branch="85" line="95"/>
  <regex pattern="com.cobertura.tool.*" branch="55" line="80"/>
  <regex pattern="com.cobertura.coverage.*" branch="85" line="90"/>
</check>
]]>
        </programlisting>



<?php include("../html-inc/footer.html"); ?>
