<?php
	$title = "Ant Task Reference";
	include("header.html");
?>

<h1>Ant Task Reference</h1>

<p>
Cobertura can be used either from the command line or via
ant tasks.  You can even mix and match the command line and
ant tasks.  This document describes how to use Cobertura
via ant tasks.
</p>



<h2>cobertura-instrument Task</h2>

<table>
<tr><th>Parameter</th><th>Required?</th><th>Description</th><th>Default Value</th></tr>
<tr><td>datafile</td><td>No</td><td>Specify the name of the file to use for storing the metadata about your classes.  This is a single file containing serialized Java classes.  It contains information about the names of classes in your project, their method names, line numbers, etc.  It will be updated as your tests are run, and will be referenced by the Cobertura reporting command.</td><td>"cobertura.ser" in the current directory</td></tr>
<tr><td>todir</td><td>No</td><td>Specify the output directory for the instrumented classes.</td><td>If no destination directory is specified, then the uninstrumented classes will be overwritten with their instrumented counterparts.</td></tr>
</table>

<p>
You must tell Cobertura which class files to instrument by passing
in standard ant filesets.  Note: As of Cobertura 1.3, we only
support <b>one</b> fileset at a time.
</p>

<p>
You can tell Cobertura to ignore certain classes by passing in
an "ignore" regular expression.  See the example below.
</p>

<p>
Example:
</p>

<div class="codeblock">
<pre><code>&lt;cobertura-instrument todir="${instrumented.dir}"&gt;
    &lt;ignore regex="org.apache.log4j.*" /&gt;
    &lt;fileset dir="${classes.dir}"&gt;
        &lt;include name="**/*.class" /&gt;
        &lt;exclude name="**/*Test.class" /&gt;
    &lt;/fileset&gt;
&lt;/cobertura-instrument&gt;</code></pre>
</div>



<br/>
<h2>Running Tests</h2>

<p>
Here's an example call to the JUnit ant task that has been
modified to work with Cobertura.  Important settings are
highlighted in <span class="highlight">blue</span>.
</p>

<div class="codeblock">
<pre><code>&lt;junit <span class="highlight">fork="yes"</span> dir="${basedir}" failureProperty="test.failed"&gt;
	&lt;!--
		Specify the name of the coverage data file to use.
		The value specified below is the default.
	--&gt;
	<span class="highlight">&lt;sysproperty key="net.sourceforge.cobertura.datafile"
		file="${basedir}/cobertura.ser" /&gt;</span>

	&lt;!--
		Note the classpath order: instrumented classes are before the
		original (uninstrumented) classes.  This is important.
	--&gt;
	<span class="highlight">&lt;classpath location="${instrumented.dir}" /&gt;</span>
	&lt;classpath location="${classes.dir}" /&gt;

	&lt;!--
		The instrumented classes reference classes used by the
		Cobertura runtime, so Cobertura and its dependencies
		must be on your classpath.
	--&gt;
	<span class="highlight">&lt;classpath refid="cobertura_classpath" /&gt;</span>

	&lt;formatter type="xml" /&gt;
	&lt;test name="${testcase}" todir="${reports.xml.dir}" if="testcase" /&gt;
	&lt;batchtest todir="${reports.xml.dir}" unless="testcase"&gt;
		&lt;fileset dir="${src.dir}"&gt;
			&lt;include name="**/*Test.java" /&gt;
		&lt;/fileset&gt;
	&lt;/batchtest&gt;
&lt;/junit&gt;</code></pre>
</div>

<p>
It is important to set fork="true" because of the way Cobertura works.
It only flushes its changes to the coverage data file to disk when
the JVM exits.  If JUnit runs in the same JVM as ant, then the
coverage data file will be updated AFTER, but you want to
run cobertura-report BEFORE ant exits.
</p>

<p>
For this same reason, if you're using ant 1.6.2 or higher then you
might want to set forkmode="once"  This will cause only one JVM
to be started for all your JUnit tests, and will reduce the overhead
of Cobertura reading/writing the coverage data file each time a JVM
starts/stops.
</p>



<br/>
<h2>cobertura-report Task</h2>

<table>
<tr><th>Parameter</th><th>Required?</th><th>Description</th><th>Default Value</th></tr>
<tr><td>format</td><td>No</td><td>The type of report you want to generate.</td><td>html</td></tr>
<tr><td>datafile</td><td>No</td><td>Specify the name of the file to use for storing the metadata about your classes.  This is a single file containing serialized Java classes.  It contains information about the names of classes in your project, their method names, line numbers, etc.  Most importantly, it will contain the number of times each line of your code was accessed during your testing.</td><td>"cobertura.ser" in the current directory</td></tr>
<tr><td>destdir</td><td>Yes</td><td>Specify the output directory for the report.</td><td>No default value.</td></tr>
<tr><td>srcdir</td><td>Yes</td><td>Specify the directory containing the source code of your project.  This is used to calculate the cyclomatic code complexity of each class.  The HTML reports are also made of annotated versions of each source file, showing which lines of code were excercised.</td><td>No default value.</td></tr>
</table>

<p>
Example:
</p>

<div class="codeblock">
<pre><code>&lt;cobertura-report format="html" destdir="${coveragereport.dir}" srcdir="${src.dir}" /&gt;</code></pre>
</div>



<?php include("footer.html"); ?>
